<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const { createClient } = supabase;

  const supabaseUrl = "https://katlyfkclruibaxyzqhr.supabase.co";
  const supabaseKey =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImthdGx5ZmtjbHJ1aWJheHl6cWhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0ODEyNTIsImV4cCI6MjA3OTA1NzI1Mn0.vzjjHAfcSysbQkDbScanK08z0tOi8_xNkmEXJFbGs9s";

  const db = createClient(supabaseUrl, supabaseKey);
  const tabla = "citas";

  const form = document.getElementById("form-cita");
  const mensajeForm = document.getElementById("mensaje-form");
  const selectServicio = document.getElementById("servicio");

  // ðŸ”¥ LEER SERVICIO DESDE LA URL
  const params = new URLSearchParams(window.location.search);
  const servicioURL = params.get("servicio");
  if (servicioURL) {
    selectServicio.value = servicioURL;
  }

  // ðŸ”¥ GUARDAR CITA
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    mensajeForm.textContent = "";
    mensajeForm.className = "mensaje";

    const nombre = document.getElementById("nombre").value.trim();
    const telefono = document.getElementById("telefono").value.trim();
    const servicio = selectServicio.value;
    const fecha = document.getElementById("fecha").value;
    const hora = document.getElementById("hora").value;
    const comentario = document.getElementById("comentario").value.trim();

    if (!nombre || !telefono || !servicio || !fecha || !hora) {
      mensajeForm.textContent = "Por favor, completa todos los campos obligatorios.";
      mensajeForm.className = "mensaje error";
      return;
    }

    const { error } = await db.from(tabla).insert({
      nombre,
      telefono,
      servicio,
      fecha,
      hora,
      comentario,
    });

    if (error) {
      mensajeForm.textContent = "Error al enviar. Intenta otra vez.";
      mensajeForm.className = "mensaje error";
    } else {
      mensajeForm.textContent =
        "Â¡Gracias! ðŸ’– Hemos recibido tu solicitud. Te escribiremos por WhatsApp para confirmarla.";
      mensajeForm.className = "mensaje ok";
      form.reset();
    }
  });
</script>

